# Engineer Data for Predictive Modeling with BigQuery ML: Challenge Lab

## Task 1. Clean your training data

Dataprep with recepies

```
filter type: greaterThan col: trip_distance greaterThan: 4 action: Keep
filter type: lessThan col: fare_amount lessThan: 2 action: Delete
filter type: greaterThan col: passenger_count greaterThan: 4 action: Keep
derive type: single value: ADD(tolls_amount, fare_amount) as: 'fare_amount_416'
drop col: vendor_id action: Drop
rename type: manual mapping: [pickup_longitude,'pickuplon']
rename type: manual mapping: [pickup_latitude,'pickuplat']
rename type: manual mapping: [dropoff_longitude,'dropofflon']
rename type: manual mapping: [dropoff_latitude,'dropofflat']
rename type: manual mapping: [passenger_count,'passengers']
filter type: custom rowType: single row: (-78 < pickuplon) && (pickuplon < -70) action: Keep
filter type: between col: pickuplat greaterThan: 37 lessThan: 45 action: Keep
filter type: custom rowType: single row: (-78 < dropofflon) && (dropofflon < -70) action: Keep
filter type: between col: dropofflat greaterThan: 37 lessThan: 45 action: Keep
drop col: rate_code action: Drop
drop col: trip_distance action: Drop
drop col: payment_type action: Drop
drop col: fare_amount action: Drop
drop col: extra action: Drop
drop col: mta_tax action: Drop
drop col: imp_surcharge action: Drop
drop col: tip_amount action: Drop
drop col: tolls_amount action: Drop
drop col: total_amount action: Drop
drop col: store_and_fwd_flag action: Drop
drop col: dropoff_datetime action: Drop
filter type: custom rowType: single row: RAND() < 0.001 action: Keep
```

## Task 2. Create a BigQuery ML model

```
CREATE OR REPLACE MODEL taxirides.fare_model_902
TRANSFORM(
  * EXCEPT(pickup_datetime),
  ST_Distance(ST_GeogPoint(pickuplon, pickuplat), ST_GeogPoint(dropofflon, dropofflat)) AS euclidean,
  CAST(EXTRACT(DAYOFWEEK FROM pickup_datetime) AS STRING) AS dayofweek,
  CAST(EXTRACT(HOUR FROM pickup_datetime) AS STRING) AS hourofday,
)
OPTIONS(input_label_cols=['fare_amount_416'], model_type='linear_reg')
AS
SELECT * FROM taxirides.taxi_training_data_123
```

## Task 3. Perform a batch prediction on new data

```
CREATE OR REPLACE TABLE `taxirides.2015_fare_amount_predictions`
AS
SELECT * FROM ML.PREDICT(MODEL taxirides.fare_model_902, (
  SELECT * FROM `taxirides.report_prediction_data`
))
```